<!DOCTYPE html>
<html>
    <head>
    <title>위치기반 채팅 프로그램 prototype</title>
    <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0, target-densityDpi=device-dpi" />
    <link rel="stylesheet"
        href="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.css" />
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>
    <script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.1.0/jquery.mobile-1.1.0.min.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <!-- <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.2/jquery.mobile-1.4.2.min.css"> -->
    <style>   
      * { margin: 0; padding: 0;  }
      body { font: 13px Helvetica, Arial; }
      form { bottom: 40px; width: 93%; }
      form input { border: 0; padding: 10px; width: 90%; margin-right: .5%; }
      .userName{ position: fixed; bottom: 40px; width:93%; }
        /*form button { width: 4%; background: rgb(130, 224, 255); border: none; padding: 10px;}*/
      #footer {padding: 3px; position: fixed; bottom: 0px; width: 100%;}
      #messages { list-style-type: none; margin: 0; padding: 0; }
      #messages li { padding: 5px 10px; }
      #messages li:nth-child(odd) { background: #eee; }
      .messageBox{  max-height:80%;}
    </style>
    <script type="text/javascript">
    var socket =io();
    var tapped = 0;
    var started = false;
    var nickName ="";
    var counter;
    var documentHiehgt;
    var userAgent = navigator.userAgent.toLowerCase();
    $(document).ready(function(){
        documentHiehgt = $( document ).height();
        $('#messageBox').height(documentHiehgt*0.7);
        socket.on('connect',function(){
            getLocation();
        });
        $("#swipe").on("swipe",function(){
            if($('#m').val() =="") return false;
                socket.emit("message",$('#m').val());
            $('#m').val('');
            $('#m').focus();
        });
    });
    socket.on('message',function(json){
      $('#messages').append($('<li>').text(json.user + " : " + json.msg));
    });
    function typing(){
        var num=0;
        clearInterval(counter);
        counter = setInterval(function(){
        if(++num == 2) {
            socket.emit('updateuser',$('#nickName').val());
            $('#userName').fadeOut(900);
            clearInterval(counter);
        } },1000);
    }
    var options = { enableHighAccuracy: true};
    function getLocation(){
            navigator.geolocation.getCurrentPosition(showPosition,onError,options);
    }
    function showPosition(position) {
        var location = {
            "lat" :position.coords.latitude,
            "long" : position.coords.longitude
        }
        socket.emit("getLocation",location);
    }   
    function onError(error) {
        alert('위치정보를 확인할 수 없습니다.');
    }
    function showKeyboard(){
        $('#messageBox').height(documentHiehgt*0.4);
        $('#m').css("margin-bottom",documentHiehgt*0.3);
    }
    function hidekeyboard(){
        $('#messageBox').height(documentHiehgt*0.7);
        $('#m').css("margin-bottom",0);
    }
    function nickKeyboardshow(){
        $('#nickName').css("margin-bottom",documentHiehgt*0.3);   
    }
    function nickKeyboardhide(){
        $('#nickName').css("margin-bottom",0);   
    }
    function onDeviceReady(){
        alert(1);
    }
    </script>
</head>
<body id = "swipe">
    <div data-role="page">
        <div data-role="header">
            <h1>위치기반 채팅 프로그램 prototype</h1>
        </div>
        <div data-role="content">
            <div class = "messageBox" id = "messageBox">
                <ul id="messages"></ul>
            </div>
                <div class="userName">
                    <input id="m" autocomplete="off" onfocus = "showKeyboard()" onblur = "hidekeyboard()" />       
                    <div class="userName" id = "userName">
                    닉네임을 입력하세요. 그리고 2초만 기다리세요. 대화가 시작됩니다. 
                    <input autocomplete="off" id ="nickName" z-index=1 onkeydown = "typing();"  onfocus = "nickKeyboardshow()" onblur = "nickKeyboardhide()" />
                    </div>
                </div>
        </div> 
        <div data-role="footer" id = "footer">
            <span sytle="font-size:smaller;text-align:right">   Copyright 2014 by Jin. All Rights Reserved.</span>
        </div>

        
</body>
</html>